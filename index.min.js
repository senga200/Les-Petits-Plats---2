"use strict";async function getRecipes(){try{const response=await fetch("recipes.json"),recipesTab=await response.json();return console.table(recipesTab),recipesTab.recipes}catch(error){console.error(error)}}let recipesTab=[];const searchInput=document.getElementById("searchInput");let result=[];const grid=document.querySelector(".grid-container"),searchInputTagIngredient=document.getElementById("searchInputTagIngredient");let allIngredients=[],ingredientsTab=[];const ingredientsList=document.querySelector("#ingredients"),ulIngredients=document.createElement("ul"),searchInputTagAppliances=document.getElementById("searchInputTagAppareil");let allAppliances=[],appliancesTab=[];const appliancesList=document.querySelector("#appareils"),ulAppliances=document.createElement("ul"),searchInputTagUstensils=document.getElementById("searchInputTagUstensile");let allUstensils=[],ustensilsTab=[];const ustensilsList=document.querySelector("#ustensiles");function displayResults(results){grid.innerHTML="",results.forEach(recipe=>{const recipeDetail=recipeFactory(recipe),recipeElement=recipeDetail.getRecipeDOM();grid.appendChild(recipeElement)}),getIngredients(result)}async function getIngredients(){try{ingredientsList.appendChild(ulIngredients),recipesTab.forEach(recipe=>{recipe.ingredients.forEach(ingredient=>{allIngredients.includes(ingredient.ingredient.toLowerCase())||allIngredients.push(ingredient.ingredient.toLowerCase())})}),allIngredients.sort((function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})),ulIngredients.innerHTML="",allIngredients.forEach(ingredient=>{const li=document.createElement("li");li.innerHTML=`<strong>${ingredient}</strong>`,ulIngredients.appendChild(li)}),console.log("total ingrédients : ",allIngredients.length)}catch(error){console.error(error)}}async function getAppliances(){try{appliancesList.appendChild(ulAppliances),recipesTab.forEach(recipe=>{allAppliances.includes(recipe.appliance.toLowerCase())||allAppliances.push(recipe.appliance.toLowerCase())}),allAppliances.sort((function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})),ulAppliances.innerHTML="",allAppliances.forEach(appliance=>{const li=document.createElement("li");li.innerHTML=`<strong>${appliance}</strong>`,ulAppliances.appendChild(li)}),console.log("total appareils : ",allAppliances.length)}catch(error){console.error(error)}}async function getUstensils(){const ulUstensils=document.createElement("ul");try{ustensilsList.appendChild(ulUstensils),recipesTab.forEach(recipe=>{recipe.ustensils.forEach(ustensil=>{allUstensils.includes(ustensil.toLowerCase())||allUstensils.push(ustensil.toLowerCase())})}),allUstensils.sort((function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})),ulUstensils.innerHTML="",allUstensils.forEach(ustensil=>{const li=document.createElement("li");li.innerHTML=`<strong>${ustensil}`,ulUstensils.appendChild(li)}),console.log("total ustensiles : ",allUstensils.length)}catch(error){console.error(error)}}searchInput.addEventListener("input",(function(){const input=searchInput.value.trim().toLowerCase();if(input.length>=3){ingredientsTab=[];for(const recipe of recipesTab){for(const ingredient of recipe.ingredients)ingredient.ingredient.toLowerCase().includes(input)&&(ingredientsTab.includes(ingredient.ingredient)||ingredientsTab.push(ingredient.ingredient));console.log("input : "+input)}result=[];for(const recipe of recipesTab)if(recipe.name.toLowerCase().includes(input)||recipe.description.toLowerCase().includes(input))result.push(recipe);else for(const ingredient of recipe.ingredients)if(ingredient.ingredient.toLowerCase().includes(input)){result.push(recipe);break}console.table("resultat result : "+JSON.stringify(result)),result.length>0?displayResults(result):grid.innerHTML='<p class="error-message">Aucune recette ne correspond à votre critère de recherche</p>'}else 0===input.length&&(ingredientsTab=[],displayResults(recipesTab));console.log("ingredientsTab searchbar principale : "+ingredientsTab)})),console.log("test"),searchInputTagIngredient.addEventListener("input",(function(){const input=searchInputTagIngredient.value.trim().toLowerCase();if(input.length>=3){ingredientsTab=[];for(const recipe of recipesTab)for(const ingredient of recipe.ingredients)ingredient.ingredient.toLowerCase().includes(input)&&(ingredientsTab.includes(ingredient.ingredient)||ingredientsTab.push(ingredient.ingredient));result=[];for(const recipe of recipesTab)if(recipe.name.toLowerCase().includes(input)||recipe.description.toLowerCase().includes(input))result.push(recipe);else for(const ingredient of recipe.ingredients)if(ingredient.ingredient.toLowerCase().includes(input)){result.push(recipe);break}console.table("resultat result : "+JSON.stringify(result)),result.length>0?(ingredientsList.innerHTML="",ingredientsTab.sort((function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})),ingredientsTab.forEach(ingredient=>{const li=document.createElement("li");li.innerHTML=`<strong>${ingredient}</strong>`,ingredientsList.appendChild(li)}),displayResults(result)):grid.innerHTML='<p class="error-message">Aucune recette ne correspond à votre critère de recherche</p>'}else 0===input.length&&(ingredientsTab=[],displayResults(recipesTab));console.log("ingredientsTab searchbar principale : "+ingredientsTab)})),console.log("test"),searchInputTagAppliances.addEventListener("input",(function(){const input=searchInputTagAppliances.value;if(input.length>=3){const result=recipesTab.filter(recipe=>recipe.appliance.toLowerCase().includes(input.toLowerCase()));result.length>0?(displayResults(result),console.log("resultat de appareils : "+result)):grid.innerHTML="Aucune recette ne correspond à votre critère de recherche"}else displayResults(recipesTab)})),searchInputTagUstensils.addEventListener("input",(function(){const input=searchInputTagUstensils.value;if(input.length>=3){const result=recipesTab.filter(recipe=>recipe.ustensils.some(ustensil=>ustensil.toLowerCase().includes(input.toLowerCase())));result.length>0?displayResults(result):grid.innerHTML="Aucune recette ne correspond à votre critère de recherche"}else displayResults(recipesTab);console.log("le result ustensile : "+result),console.log("tableau ingredientTab : "+ingredientsTab)}));const blocSearchAppareils=document.querySelector(".blocSearchAppareils");let toggleIndexAppareils=0;blocSearchAppareils.addEventListener("click",(function(){const chevronAppareils=document.querySelector("#chevronAppareils");0===toggleIndexAppareils?(appliancesList.style.height=`${appliancesList.scrollHeight}px`,appliancesList.classList.toggle("expanded"),chevronAppareils.classList.add("rotated"),toggleIndexAppareils++):toggleIndexAppareils>0&&(appliancesList.style.height=`${blocSearchAppareils.scrollHeight}px`,appliancesList.classList.remove("expanded"),chevronAppareils.classList.remove("rotated"),toggleIndexAppareils--)})),searchInputTagAppliances.addEventListener("click",(function(){0===toggleIndexAppareils?(appliancesList.style.height=`${appliancesList.scrollHeight}px`,appliancesList.classList.toggle("expanded"),toggleIndexAppareils++):toggleIndexAppareils>0&&(appliancesList.style.height=`${blocSearchAppareils.scrollHeight}px`,appliancesList.classList.remove("expanded"),toggleIndexAppareils--)}));const blocSearchIngredients=document.querySelector(".blocSearchIngredients");let toggleIndexIngredients=0;blocSearchIngredients.addEventListener("click",(function(){const chevronIngredients=document.querySelector("#chevronIngredients");0===toggleIndexIngredients?(ingredientsList.style.height=`${ingredientsList.scrollHeight}px`,ingredientsList.classList.toggle("expanded"),chevronIngredients.classList.add("rotated"),toggleIndexIngredients++):toggleIndexIngredients>0&&(ingredientsList.style.height=`${blocSearchIngredients.scrollHeight}px`,ingredientsList.classList.remove("expanded"),chevronIngredients.classList.remove("rotated"),toggleIndexIngredients--)})),searchInputTagIngredient.addEventListener("click",(function(){0===toggleIndexIngredients?(ingredientsList.style.height=`${ingredientsList.scrollHeight}px`,ingredientsList.classList.toggle("expanded"),toggleIndexIngredients++):toggleIndexIngredients>0&&(ingredientsList.style.height=`${blocSearchIngredients.scrollHeight}px`,ingredientsList.classList.remove("expanded"),toggleIndexIngredients--)}));const blocSearchUstensiles=document.querySelector(".blocSearchUstensiles");let toggleIndexUstensiles=0;blocSearchUstensiles.addEventListener("click",(function(){const chevronUstensiles=document.querySelector("#chevronUstensiles");0===toggleIndexUstensiles?(ustensilsList.style.height=`${ustensilsList.scrollHeight}px`,ustensilsList.classList.toggle("expanded"),chevronUstensiles.classList.add("rotated"),toggleIndexUstensiles++):toggleIndexUstensiles>0&&(ustensilsList.style.height=`${blocSearchUstensiles.scrollHeight}px`,ustensilsList.classList.remove("expanded"),chevronUstensiles.classList.remove("rotated"),toggleIndexUstensiles--)})),searchInputTagUstensils.addEventListener("click",(function(){0===toggleIndexUstensiles?(ustensilsList.style.height=`${ustensilsList.scrollHeight}px`,ustensilsList.classList.toggle("expanded"),toggleIndexUstensiles++):toggleIndexUstensiles>0&&(ustensilsList.style.height=`${blocSearchUstensiles.scrollHeight}px`,ustensilsList.classList.remove("expanded"),toggleIndexUstensiles--)}));const tags=document.querySelector("#tags"),selectedTags=[];function createTag(inputValue){const liTag=document.querySelectorAll("#ingredients li, #ustensiles li, #appareils li");liTag.forEach(li=>{const itemName=li.textContent.trim().toLowerCase();if(itemName.includes(inputValue)){const tag=document.createElement("span");tag.innerHTML=`<strong>${itemName}</strong>`;const closeBtn=document.createElement("i");closeBtn.classList.add("fa-regular","fa-times-circle"),tag.classList.add("selected"),li.closest("#ingredients")?tag.style.backgroundColor="#3282F7":li.closest("#ustensiles")?tag.style.backgroundColor="#ED6454":li.closest("#appareils")&&(tag.style.backgroundColor="#68d9a4"),tags.appendChild(tag),tag.appendChild(closeBtn),closeBtn.addEventListener("click",(function(){tag.style.display="none"}))}}),tags.querySelectorAll(".selected").length>0?tags.style.display="block":tags.style.display="none"}function filterRecipes(){const searchText=searchInput.value.toLowerCase().trim(),filteredRecipes=recipesTab.filter(recipe=>{const ingredients=recipe.ingredients.map(ingredient=>ingredient.ingredient.toLowerCase()),ustensiles=recipe.ustensils.map(ustensile=>ustensile.toLowerCase()),appareils=recipe.appliance.toLowerCase(),includesSearchText=recipe.name.toLowerCase().includes(searchText)||ingredients.includes(searchText)||ustensiles.includes(searchText)||appareils.includes(searchText),includesSelectedTags=selectedTags.every(tag=>ingredients.includes(tag)||ustensiles.includes(tag)||appareils.includes(tag));return includesSearchText&&includesSelectedTags});filteredRecipes.length>0?displayResults(filteredRecipes):grid.innerHTML="<p>Aucune recette ne correspond à votre recherche.</p>"}async function getRecipe(){try{recipesTab=await getRecipes(),grid.innerHTML="",recipesTab.forEach(recipe=>{const recipeDetail=recipeFactory(recipe),recipeElement=recipeDetail.getRecipeDOM();grid.appendChild(recipeElement)}),getIngredients(result),getAppliances(result),getUstensils(result)}catch(error){console.error(error)}}ingredientsList.addEventListener("click",(function(e){if("LI"===e.target.tagName){const ingredient=e.target.textContent.trim().toLowerCase();createTag(ingredient),selectedTags.push(ingredient),filterRecipes(),console.log("tags selectionnés : "+selectedTags),console.log("ingredient current : "+ingredient);const liTag=document.querySelectorAll("#ingredients li");liTag.forEach(li=>{li.textContent.trim().toLowerCase()===ingredient&&li.remove()})}})),ustensilsList.addEventListener("click",(function(e){if("LI"===e.target.tagName){const ustensile=e.target.textContent.trim().toLowerCase();createTag(ustensile),selectedTags.push(ustensile),filterRecipes(),console.log("tags selectionnés : "+selectedTags),console.log("ustensile current : "+ustensile);const liTag=document.querySelectorAll("#ustensiles li");liTag.forEach(li=>{li.textContent.trim().toLowerCase()===ustensile&&li.remove()})}})),appliancesList.addEventListener("click",(function(e){if("LI"===e.target.tagName){const appareil=e.target.textContent.trim().toLowerCase();createTag(appareil),selectedTags.push(appareil),filterRecipes(),console.log("tags selectionnés : "+selectedTags),console.log("appareil current : "+appareil);const liTag=document.querySelectorAll("#appareils li");liTag.forEach(li=>{li.textContent.trim().toLowerCase()===appareil&&li.remove()})}})),tags.addEventListener("click",(function(e){if("I"===e.target.tagName){const item=e.target.previousElementSibling.textContent.trim().toLowerCase();e.target.previousElementSibling.remove(),e.target.remove();const index=selectedTags.indexOf(item);index>-1&&selectedTags.splice(index,1),filterRecipes(),console.log(selectedTags)}})),getRecipe();